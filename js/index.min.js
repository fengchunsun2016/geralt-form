!function(e){var t={};function i(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,i),o.l=!0,o.exports}i.m=e,i.c=t,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:n})},i.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=0)}([function(e,t,i){"use strict";$(function(){var e,t=void 0,i=void 0,n=void 0,o=void 0,s=void 0,a=void 0,r=null,c=null,l=void 0,d=void 0,m=1,f=1,p=0,h=0,v=!1,g=void 0,u=null,y=null,k=void 0,x=void 0,w=1,T=1,L=0,b=0,C=!1,j=!1,S=!1,M=!1,N=0,E=0,I=0,D=0,B=!1,F=!1,P=!1,U=!1,z=!1;function O(){$.ajax({url:domain+"/order/reject/count",type:"GET",dataType:"json",headers:{token:t,userId:i},success:function(e){if("SUCCESS"==e.code){if(e.count>0){M=!0;var t=$(".reject");e.rejectReason&&null!=e.rejectReason?$(".reject-reason").text("(驳回理由："+e.rejectReason+")"):$(".reject-reason").text(""),t.show()}}else layer.open({content:e.msg,skin:"msg",time:3})},error:function(e){console.log(e)},complete:function(){}})}function H(){$.ajax({url:domain+"/info",type:"GET",cache:!0,dataType:"json",data:{},headers:{token:t,userId:i},success:function(e){if("SUCCESS"==e.code){n=e.phone;var t=e.phone.substr(0,3)+"****"+e.phone.substr(7,11);$("#phone").text(t),$("#my-name").text(e.branchName),$("#my-account").text(e.username)}else ae(e.code),layer.open({content:e.msg,skin:"msg",time:3}),$("#warning").text(e.msg).show()},error:function(e){console.log(e)}})}function _(){r=$("#search").val(),m=1,$("#wrapper .list").html(""),B||A()}function q(){c=$("#search-meitong").val(),f=1,$("#wrapper-meitong .list").html(""),F||X()}e=!1,$("#submit").on("tap",function(){var n=$("#username").val(),s=$("#password").val();if(n&&s){$("#warning").css({display:"none"}),s=md5(s).toUpperCase();var a={username:n,password:s};e||(e=!0,$.ajax({url:domain+"/login",type:"POST",cache:!0,dataType:"json",data:a,success:function(e){var n,s;"SUCCESS"==e.code?(t=e.token,i=e.userId,sessionStorage.setItem("loginFlag",e.loginFlag),n=!1,s=!1,1==sessionStorage.getItem("loginFlag")?($("footer").off("tap"),$("footer .record").off("tap"),$("footer .record").on("tap",function(){$("#record").show().siblings().hide()}),$("footer .my-form").off("tap"),$("footer .my-form").on("tap",function(){$("#my-form").show().siblings().hide(),$(window).scrollTop()>0&&$(window).scrollTop(0),G.refresh(),R.refresh(),Q.refresh(),ee.refresh(),n||(r=null,m=1,A(),n=!0)}),$("footer .my-account").off("tap"),$("footer .my-account").on("tap",function(){$("#myAccount").show().siblings().hide(),s||(H(),s=!0)})):$("footer").on("tap",function(){layer.open({content:"修改密码后才可以正常使用",skin:"msg",time:3})}),1==e.loginFlag?($("#record").show().siblings().hide(),function(){var e=null,n=!1;function s(){var n=$("#custom-phone").val();if(n)if(re(n)){var o=60;clearInterval(e),$("#time_").text(o+"s"),e=setInterval(function(){--o>=0?$("#time_").text(o+"s"):(clearInterval(e),$("#time_").text("重新获取"),$("#get-custom-identify").on("tap",s))},1e3),$("#get-custom-identify").off("tap",s),$.ajax({url:domain+"/sms",type:"POST",cache:!0,dataType:"json",data:{phone:n,type:"2"},headers:{token:t,userId:i},success:function(e){"SUCCESS"==e.code||(ae(e.code),layer.open({content:e.msg,skin:"msg",time:3}))},error:function(e){console.log(e)}})}else layer.open({content:"手机号码格式输入有误！！",skin:"msg",time:2});else layer.open({content:"请输入手机号码！！",skin:"msg",time:2})}function a(){var a={exchangeType:N},r=$("#custom-name").val(),c=$("#custom-id").val(),l=$("#custom-phone").val(),d=$("#custom-identify").val();if(1==o.formName){if(!r)return void layer.open({content:"请输入姓名",skin:"msg",time:2});if(!(r.length<15))return void layer.open({content:"姓名长度过长",skin:"msg",time:2});a.name=r}if(1==o.formIdCard){if(!c)return void layer.open({content:"请输入身份证号",skin:"msg",time:2});if(!ce(c))return void layer.open({content:"身份证号格式输入有误",skin:"msg",time:2});a.idCard=c}if(1==o.formPhone){if(!l)return void layer.open({content:"请输入手机号码",skin:"msg",time:2});if(!re(l))return void layer.open({content:"手机号码格式输入有误！",skin:"msg",time:2});a.phone=l}if(1==o.formPhoneAuthc){if(!d)return void layer.open({content:"请输入验证码！",skin:"msg",time:2});a.smsCode=d}if(1==o.formTicket){var m=[],f=[];if(0==N&&$("#dianzi-list input[class=right]").each(function(e,t){var i={},n=$(t).val();f.push(n),i.formTicketCode=$(t).attr("ticket-code"),i.total=n,m.push(i)}),1==N&&$("#meitong-list input[class=right]").each(function(e,t){var i={},n=$(t).val();f.push(n),i.formTicketMeitongCode=$(t).attr("ticket-code"),i.total=n,m.push(i)}),!f.some(function(e){return 1==!!e}))return void layer.open({content:"请至少填写一种券码数量！",skin:"msg",time:2});if(!f.every(function(e){return 0==isNaN(e)}))return void layer.open({content:"券码数量必须为数字！",skin:"msg",time:2});if(0==N&&(a.ticketList=m),1==N&&(a.meitongTicketList=m),1==N&&$("#meitongMin").val()&&$("#meitongMin").val()<o.meitongNumberMin)return void layer.open({content:"起兑量必须大于等于"+o.meitongNumberMin+"！",skin:"msg",time:2})}if(1==o.formDate){var p=$("#select-date").val();if(!p)return void layer.open({content:"请选择日期！",skin:"msg",time:2});a.date=p}n||(n=!0,$.ajax({url:domain+"/order/save",type:"POST",dataType:"json",contentType:"application/json;charset=utf-8",cache:!0,data:JSON.stringify(a),headers:{token:t,userId:i},success:function(t){"SUCCESS"==t.code?(layer.open({content:"保存成功",skin:"msg",time:2}),$("#record .custom input").val(""),$("#record .ticket input").val(""),$("#record .date input").val(""),clearInterval(e),$("#time_").text("获取验证码"),$("#get-custom-identify").off("tap"),$("#get-custom-identify").on("tap",s)):(ae(t.code),layer.open({content:t.msg,skin:"msg",time:3}))},error:function(e){console.log(e)},complete:function(e){n=!1}}))}$.ajax({url:domain+"/form",type:"GET",dataType:"json",cache:!0,headers:{token:t,userId:i},success:function(e){"SUCCESS"==e.code?(o=e,function(e){var t=new Date,i=t.getFullYear(),n=t.getMonth()+1,o=t.getDate(),s=i+"-"+n+"-"+o,a="",r="",c="";if(1==e.formName&&(a+='<li class="item custom-name">\n        <div class="left name">姓名</div>\n        <input type="text" id="custom-name" placeholder="请输入姓名">\n      </li>'),1==e.formIdCard&&(a+='<li class="item custom-id">\n        <div class="left id">身份证号码</div>\n        <input type="text" id="custom-id" placeholder="请输入身份证号">\n      </li>'),1==e.formPhone&&(a+='<li class="item custom-phone">\n        <div class="left phone">手机号码</div>\n        <input type="text" id="custom-phone" placeholder="请输入银行预留手机号">\n      </li>'),1==e.formPhoneAuthc&&(a+='<li class="item custom-identify">\n        <input type="text" placeholder="请输入验证码" id="custom-identify">\n        <div class="get-custom-identify" id="get-custom-identify"><span class="line"></span> <p id="time_">获取验证码</p></div>\n      </li>'),1==e.formTicket){if(r+='<div class="tittle">\n                    券码信息\n                  </div>',1==e.formExchangeType&&(r+='<div class="formExchangeType" id="formExchangeType">\n                        <div class="prefix">\n                          兑换类型\n                        </div>\n                        <ul class="exchangeTypeList">\n                          <li class="dianzi active">\n                            电子券\n                          </li>\n                          <li class="meitong">\n                            美通卡\n                          </li>\n                        </ul>\n                      </div>\n                      '),e.formTicketList&&e.formTicketList.length){r+='<div class="list dianzi-list" id="dianzi-list">\n                        <div class="list-item header">\n                          <div class="left">券码面值</div>\n                          <div class="right">数量</div>\n                        </div>';for(var l=0;l<e.formTicketList.length;l++){var d=e.formTicketList[l];r+='<div class="list-item item">\n        <div class="left">'+d.faceValue+'</div>\n        <input type="text" class="right" placeholder="输入兑换张数" ticket-code='+d.formTicketCode+">\n      </div>"}1==e.formExchangeType&&(r+='<div class="meitong-tips" id="meitong-tips">\n                      <span class="iconfont icon-tishi1"></span>\n                      如需同时兑换电子券和美通卡，需分别获取验证码，保存各自表单。\n                    </div>'),r+="</div>"}if(1==e.formExchangeType&&e.formMeitongTicketList&&e.formMeitongTicketList.length){r+='<div class="list meitong-list" id="meitong-list">\n                        <div class="list-item header">\n                          <div class="left">券码面值</div>\n                          <div class="right">数量</div>\n                        </div>';for(var m=e.formMeitongTicketList.length,f=0;f<m;f++){var p=e.formMeitongTicketList[f];e.meitongFaceMin==p.amount?r+='<div class="list-item item">\n        <div class="left">'+p.amount+'元</div>\n        <input type="text" class="right" placeholder="输入兑换张数" ticket-code='+p.formTicketMeitongCode+' id="meitongMin">\n      </div>':r+='<div class="list-item item">\n        <div class="left">'+p.amount+'元</div>\n        <input type="text" class="right" placeholder="输入兑换张数" ticket-code='+p.formTicketMeitongCode+">\n      </div>"}r+='<div class="meitong-tips" id="meitong-tips">\n                      <span class="iconfont icon-tishi1" style="display:inline-block"></span>\n                      \n                      美通卡兑换最小面值'+e.meitongFaceMin+"元，"+e.meitongNumberMin+"张起兑。\n                      <p>如需同时兑换电子券和美通卡，需分别获取验证码，保存各自表单。</p>\n\n                      \n                    </div>",r+="</div>"}}if(1==e.formDate&&(c+='<div class="tittle">\n      日期\n    </div>\n    \n    <input class="select-date" id="select-date" type="text" readonly="" name="input_date" placeholder="请选择日期" data-lcalendar="'+s+',2030-12-31" />'),$("#custom-info").html(a),$("#custom-ticket").html(r),$("#custom-date").html(c),1==e.formDate){var h=new lCalendar;h.init({trigger:"#select-date",type:"date"})}}(e),e.formExchangeType&&1==e.formExchangeType&&($("#meitongMin").on("change",function(){var t=Number($(this).val());isNaN(t)?($(this).val(""),layer.open({content:"请输入有效正整数！",skin:"msg",time:3})):t<e.meitongNumberMin&&($(this).val(""),layer.open({content:"此项起兑量必须大于等于"+e.meitongNumberMin+"！",skin:"msg",time:3}))}),$("#formExchangeType .exchangeTypeList li").on("tap",function(){if(!$(this).hasClass("active")){$(this).addClass("active").siblings().removeClass("active");var e=$(this).index();N=e,0==e?($("#dianzi-list").show(),$("#meitong-list").hide(),$("#meitong-list input").val("")):1==e&&($("#meitong-list").show(),$("#dianzi-list").hide(),$("#dianzi-list input").val(""))}})),1==e.formPhoneAuthc&&1==e.submitFlag&&($("#get-custom-identify").off("tap"),$("#get-custom-identify").on("tap",s)),1==e.formPhoneAuthc&&0==e.submitFlag&&$("#get-custom-identify").css({color:"#ccc"}),1==e.submitFlag?($("#save-form").off("tap"),$("#save-form").on("tap",a)):$("#save-form").css({color:"#ccc"})):(ae(e.code),layer.open({content:e.msg,skin:"msg",time:3}))},error:function(e){console.log(e)}})}(),$("#repassword .header-bar .left").html('<i class="iconfont icon-back"></i>'),$("#repassword .header-bar .left .icon-back").on("tap",function(){$("#info-box").show(),$("#repassword").hide(),$("#repassword form input").val("")}),O()):($("#repassword").show(),$("#info-box").hide(),$("#myAccount").show().siblings().hide(),H()),$("#username").val(""),$("#password").val("")):($("#warning").text(e.msg).show(),layer.open({content:e.msg,skin:"msg",time:3}))},error:function(e){console.log(e),layer.open({content:e,skin:"msg",time:3})},complete:function(t){e=!1}}))}else n||($("#warning").text("请输入账号").show(),$("#username").focus()),s||($("#warning").text("请输入密码").show(),$("#password").focus())}),function(){var e=null;function o(){var s=$("#old-password").val(),a=$("#new-password").val(),r=$("#new-password-again").val();if(s&&a&&r&&a==r){var c=60;clearInterval(e),$("#time").text(c+"s"),e=setInterval(function(){--c>=0?$("#time").text(c+"s"):(clearInterval(e),$("#time").text("重新获取"),$("#get-identify").on("tap",o))},1e3),$("#get-identify").off("tap",o),$.ajax({url:domain+"/sms",type:"POST",cache:!0,dataType:"json",data:{phone:n,type:"1"},headers:{token:t,userId:i},success:function(e){"SUCCESS"==e.code||($("#tips").text(e.msg).show(),ae(e.code),layer.open({content:e.msg,skin:"msg",time:3}))},error:function(e){console.log(e)}})}else s?a?r?a!=r&&$("#tips").text("密码输入不一致，请重新输入").parent().show():$("#tips").text("请再次输入新密码").parent().show():$("#tips").text("请输入新密码").parent().show():$("#tips").text("请输入旧密码").parent().show()}$("#get-identify").on("tap",o),$("#save").on("tap",function(){var n=$("#old-password").val(),s=$("#new-password").val(),a=$("#new-password-again").val(),r=$("#identify").val();n&&s&&a&&r&&s==a?(n=md5(n).toUpperCase(),s=md5(s).toUpperCase(),a=md5(a).toUpperCase(),j||(j=!0,$.ajax({url:domain+"/repassword",type:"POST",cache:!0,dataType:"json",data:{oldPassword:n,newPassword:s,confirmPassword:a,smsCode:r},headers:{token:t,userId:i},success:function(t){"SUCCESS"==t.code?($("#login").show().siblings().hide(),$("#repassword").hide(),$("#info-box").show(),$("#repassword input").val(""),clearInterval(e),$("#time").text("获取验证码"),$("#get-identify").off("tap"),$("#get-identify").on("tap",o)):(ae(t.code),layer.open({content:t.msg,skin:"msg",time:3}),$("#tips").text(t.msg).css({display:"block"}))},error:function(e){console.log(e)},complete:function(e){j=!1}}))):n?s?a?r?s!=a&&$("#tips").text("密码输入不一致，请重新输入").parent().show():$("#tips").text("请输入验证码").parent().show():$("#tips").text("请再次输入新密码").parent().show():$("#tips").text("请输入新密码").parent().show():$("#tips").text("请输入原密码").parent().show()})}(),$("#change-password").on("tap",function(){$("#info-box").hide(),$("#repassword").show()}),$("#exit").on("tap",function(){$.ajax({url:domain+"/logout",type:"POST",cache:!0,dataType:"json",data:{},headers:{token:t,userId:i},success:function(e){"SUCCESS"==e.code?(window.location.reload(),$("#login").show().siblings().hide()):(ae(e.code),layer.open({content:e.msg,skin:"msg",time:3}))},error:function(e){layer.open({content:e,skin:"msg",time:3})}})}),$("#submit-form").on("tap",function(){M?layer.open({content:"驳回表单处理后才可以提交今日表单哦！",skin:"msg",time:3}):v||$.dialog({type:"confirm",onClickOk:function(){v=!0,$.ajax({url:domain+"/order/submit",type:"POST",dataType:"json",data:{orderNo:a},headers:{token:t,userId:i},success:function(e){"SUCCESS"==e.code?($("#have-submit").show(),$("#order-list").hide(),$("#get-custom-identify").off("tap").css({color:"#ccc"}),$("#save-form").off("tap").css({color:"#ccc"})):(ae(e.code),layer.open({content:e.msg,skin:"msg",time:3}))},error:function(e){console.log(e)},complete:function(e){v=!1}})},onClickCancel:function(){},contentHtml:'<p style="text-align: center">确定要提交表单？</p>'})}),$("#search").on("input",function(){0==this.value.length?$("#search-btn").off("tap",_).css({borderColor:"#ccc",color:"#ccc"}):$("#search-btn").css({borderColor:"#3ca9c8",color:"#3ca9c8"}).off("tap").on("tap",_)}),$("#search-meitong").on("input",function(){0==this.value.length?$("#search-btn-meitong").off("tap",q).css({borderColor:"#ccc",color:"#ccc"}):$("#search-btn-meitong").css({borderColor:"#3ca9c8",color:"#3ca9c8"}).off("tap").on("tap",q)});var G=new IScroll("#wrapper",{scrollX:!0,probeType:2,mouseWheel:!0,scrollbars:!1});G.on("scroll",function(){p=this.y,this.y>0&&(this.y>50?($("#pull-refresh-box").css({height:"50"}),$("#pull-refresh").html('<span class="iconfont icon-xiangshang"></span>释放立即刷新')):($("#pull-refresh-box").css({height:this.y}),$("#pull-refresh").html('<span class="iconfont icon-xiangxia"></span>继续下拉刷新')))}),G.on("scrollEnd",function(){p>0&&($("#pull-refresh-box").animate({height:0}),p>50&&($("#load-more").text("正在努力加载数据...").show(),m=1,r=null,$("#search").val(""),$("#wrapper .list").html(""),$("#search-btn").off("tap").css({borderColor:"#ccc",color:"#ccc"}),B||(A(),O()))),this.wrapperHeight-this.y>=this.scrollerHeight&&(l?($("#load-more").text("正在努力加载数据...").show(),J()):$("#load-more").text("没有更多数据了").show())});var V,R=new IScroll("#wrapper-meitong",{scrollX:!0,probeType:2,mouseWheel:!0,scrollbars:!1});function A(){B=!0,$.ajax({url:domain+"/form",type:"GET",dataType:"json",cache:!0,headers:{token:t,userId:i},success:function(e){var t=7.8;if("SUCCESS"==e.code)if(o=e,1==e.submitFlag){1==e.formExchangeType&&$("#exchangeTypeListSearchBox").show();var i='<li class="header clearBoth">\n        <div class="index floatL">序号</div>';1==e.formName&&(i+='<div class="name floatL">姓名</div>',t+=1.5),1==e.formIdCard&&(i+='<div class="card-id floatL">身份证号</div>',t+=3.2),1==e.formPhone&&(i+='<div class="phone floatL">手机号</div>',t+=2),1==e.formTicket&&(i+='<div class="coupon floatL">券码面值/数量</div>',t+=2),1==e.formDate&&(i+='<div class="date floatL">日期</div>',t+=2),i+='<div class="modify-person floatL">提交人</div>\n        <div class="last-modify-person floatL">最后修改人</div>\n        <div class="time floatL">最后修改时间</div></li>',$("#wrapper .list").html(i),$("#scroller").css({width:t+"rem"}),J()}else $("#order-list").hide(),$("#have-submit").show();else ae(e.code),layer.open({content:e.msg,skin:"msg",time:3})},error:function(e){console.log(e)}})}function J(){$.ajax({url:domain+"/order/query",type:"GET",cache:!0,dataType:"json",data:{query:r,page:m,exchangeType:0},headers:{token:t,userId:i},success:function(e){if("SUCCESS"==e.code){a=e.orderNo,l=!(!e.list||20!=e.list.length);var t="",i=e.list;if(i&&i.length)for(var n=0;n<i.length;n++){var o=i[n];if(t+="<li detail-code="+o.detailCode+' class="form-item clearBoth"><div class="index floatL">'+(n+20*(m-1)+1)+"</div>",o.name&&(t+='<div class="name floatL">'+o.name+"</div>"),o.idCard&&(t+='<div class="card-id floatL">'+o.idCard+"</div>"),o.phone&&(t+='<div class="phone floatL">'+o.phone+"</div>"),o.ticketList){t+='<div class="coupon floatL">';for(var s=0;s<o.ticketList.length;s++){var r=o.ticketList[s];t+="<p>"+r.faceValue+"/"+r.total+"张；</p>"}t+="</div>"}o.date&&(t+='<div class="date floatL">'+o.date+"</div>"),t+='<div class="modify-person floatL">'+(o.createBy?o.createBy:"--")+'</div><div class="last-modify-person floatL">'+(o.modifyBy?o.modifyBy:"--")+'</div><div class="time floatL">'+(o.modifyTime?o.modifyTime:"--")+"</div></li>"}$("#wrapper .list").append(t),$("#scroller").css("height")<=$("#wrapper").css("height")&&$("#scroller").css("height",$("#wrapper").css("height")+"1px"),Y(),G.refresh(),m++,l?$("#load-more").hide():$("#load-more").text("没有更多数据了").show(),$("#wrapper .scroller .list .coupon").each(function(e,t){1==$(t).find("p").length&&$(t).css({lineHeight:"0.68rem"}),$(t).find("p").length>=3&&$(t).parent().css({lineHeight:.34*$(t).find("p").length+"rem"})})}else ae(e.code),layer.open({content:e.msg,skin:"msg",time:3})},error:function(e){console.log(e)},complete:function(){B=!1}})}function X(){F=!0,$.ajax({url:domain+"/form",type:"GET",dataType:"json",cache:!0,headers:{token:t,userId:i},success:function(e){var t=7.8;if("SUCCESS"==e.code)if(o=e,1==e.submitFlag){1==e.formExchangeType&&$("#exchangeTypeListSearchBox").show();var i='<li class="header clearBoth">\n        <div class="index floatL">序号</div>';1==e.formName&&(i+='<div class="name floatL">姓名</div>',t+=1.5),1==e.formIdCard&&(i+='<div class="card-id floatL">身份证号</div>',t+=3.2),1==e.formPhone&&(i+='<div class="phone floatL">手机号</div>',t+=2),1==e.formTicket&&(i+='<div class="coupon floatL">券码面值/数量</div>',t+=2),1==e.formDate&&(i+='<div class="date floatL">日期</div>',t+=2),i+='<div class="modify-person floatL">提交人</div>\n        <div class="last-modify-person floatL">最后修改人</div>\n        <div class="time floatL">最后修改时间</div></li>',$("#wrapper-meitong .list").html(i),$("#scroller-meitong").css({width:t+"rem"}),W()}else $("#order-list").hide(),$("#have-submit").show();else ae(e.code),layer.open({content:e.msg,skin:"msg",time:3})},error:function(e){console.log(e)}})}function W(){$.ajax({url:domain+"/order/query",type:"GET",cache:!0,dataType:"json",data:{query:c,page:f,exchangeType:1},headers:{token:t,userId:i},success:function(e){if("SUCCESS"==e.code){a=e.orderNo,d=!(!e.list||20!=e.list.length);var t="",i=e.list;if(i&&i.length)for(var n=0;n<i.length;n++){var o=i[n];if(t+="<li detail-code="+o.detailCode+' class="form-item clearBoth"><div class="index floatL">'+(n+20*(f-1)+1)+"</div>",o.name&&(t+='<div class="name floatL">'+o.name+"</div>"),o.idCard&&(t+='<div class="card-id floatL">'+o.idCard+"</div>"),o.phone&&(t+='<div class="phone floatL">'+o.phone+"</div>"),o.meitongTicketList){t+='<div class="coupon floatL">';for(var s=0;s<o.meitongTicketList.length;s++){var r=o.meitongTicketList[s];t+="<p>"+r.amount+"元/"+r.total+"张；</p>"}t+="</div>"}o.date&&(t+='<div class="date floatL">'+o.date+"</div>"),t+='<div class="modify-person floatL">'+(o.createBy?o.createBy:"--")+'</div><div class="last-modify-person floatL">'+(o.modifyBy?o.modifyBy:"--")+'</div><div class="time floatL">'+(o.modifyTime?o.modifyTime:"--")+"</div></li>"}$("#wrapper-meitong .list").append(t),$("#scroller-meitong").css("height")<=$("#wrapper").css("height")&&$("#scroller-meitong").css("height",$("#wrapper").css("height")+"1px"),Y(),R.refresh(),f++,d?$("#load-more-meitong").hide():$("#load-more-meitong").text("没有更多数据了").show(),$("#wrapper-meitong .scroller .list .coupon").each(function(e,t){1==$(t).find("p").length&&$(t).css({lineHeight:"0.68rem"}),$(t).find("p").length>=3&&$(t).parent().css({lineHeight:.34*$(t).find("p").length+"rem"})})}else ae(e.code),layer.open({content:e.msg,skin:"msg",time:3})},error:function(e){console.log(e)},complete:function(){F=!1}})}function Y(){$(".scroller .list .form-item").off("tap"),$(".scroller .list .form-item").on("tap",function(){$("#order-detail").show().siblings().hide();var e=$(this).attr("detail-code");sessionStorage.setItem("detailCode",e);var t=$(this).find(".index").text();sessionStorage.setItem("serialNumber",t),K()})}function K(){var e=sessionStorage.getItem("detailCode"),n=sessionStorage.getItem("serialNumber");e?$.ajax({url:domain+"/order/detail",type:"GET",dataType:"json",cache:!0,data:{detailCode:e},headers:{token:t,userId:i},success:function(e){if("SUCCESS"!=e.code)return ae(e.code),void layer.open({content:e.msg,skin:"msg",time:3});window.detailData=e;var t="",i="",o="";if(e.detailCode&&(t+='<div class="index">\n        <span class="icon"></span>\n        <span class="name">序号：</span>\n        <span class="num">'+n+"</span>\n      </div>"),t+='<div class="info">',e.name&&(t+='\n        <div class="name info-item">\n          <span class="lable">姓名：</span>\n          <span class="content">'+e.name+"</span>\n        </div>"),e.idCard&&(t+='<div class="id-card info-item">\n          <span class="lable">身份证号：</span>\n          <span class="content">'+e.idCard+"</span>\n        </div>"),e.phone&&(t+='<div class="phone info-item">\n          <span class="lable">手机号：</span>\n          <span class="content">'+e.phone+"</span>\n        </div>"),t+="</div>",(!e.exchangeType||0==e.exchangeType)&&e.ticketList&&e.ticketList.length){i+='<div class="index">\n        <span class="icon"></span>\n        <span class="name">券码面值/数量</span>\n      </div>\n      <ul class="ticket-list">\n        <li class="ticket-item ticket-header">\n          <div>券码面值</div>\n          <div>数量</div>\n        </li>';for(var s=0;s<e.ticketList.length;s++){var a=e.ticketList[s];i+='<li class="ticket-item">\n          <div>'+a.faceValue+"</div>\n          <div>"+a.total+"张</div>\n        </li>"}i+="</ul>"}if(e.exchangeType&&1==e.exchangeType&&e.meitongTicketList&&e.meitongTicketList.length){i+='<div class="index">\n        <span class="icon"></span>\n        <span class="name">券码面值/数量</span>\n      </div>\n      <ul class="ticket-list">\n        <li class="ticket-item ticket-header">\n          <div>券码面值</div>\n          <div>数量</div>\n        </li>';for(var r=0;r<e.meitongTicketList.length;r++){var c=e.meitongTicketList[r];i+='<li class="ticket-item">\n          <div>'+c.amount+"元</div>\n          <div>"+c.total+"张</div>\n        </li>"}i+="</ul>"}e.date&&(o+='<div>\n        <span class="label">日期：</span>\n        <span class="content">'+e.date+"</span>\n      </div>"),o+='<div>\n        <span class="label">提交人：</span>\n        <span class="content">'+e.createBy+'</span>\n      </div>\n      <div>\n        <span class="label">最后修改人：</span>\n        <span class="content">'+e.modifyBy+'</span>\n      </div>\n      <div>\n        <span class="label">最后修改时间：</span>\n        <span class="content">'+e.modifyTime+"</span>\n      </div>",$("#basic-info").html(t),$("#ticket-detail").html(i),$("#others").html(o)},error:function(e){console.log(e)}}):alert("貌似木有详情订单编号哦")}R.on("scroll",function(){h=this.y,this.y>0&&(this.y>50?($("#pull-refresh-box-meitong").css({height:"50"}),$("#pull-refresh-meitong").html('<span class="iconfont icon-xiangshang"></span>释放立即刷新')):($("#pull-refresh-box-meitong").css({height:this.y}),$("#pull-refresh-meitong").html('<span class="iconfont icon-xiangxia"></span>继续下拉刷新')))}),R.on("scrollEnd",function(){h>0&&($("#pull-refresh-box-meitong").animate({height:0}),h>50&&($("#load-more-meitong").text("正在努力加载数据...").show(),f=1,c=null,$("#search-meitong").val(""),$("#wrapper-meitong .list").html(""),$("#search-btn-meitong").off("tap").css({borderColor:"#ccc",color:"#ccc"}),F||(X(),O()))),this.wrapperHeight-this.y>=this.scrollerHeight&&(d?($("#load-more-meitong").text("正在努力加载数据...").show(),W()):$("#load-more-meitong").text("没有更多数据了").show())}),V=!1,$("#exchangeTypeListSearch li").on("tap",function(){var e=$(this).index();e,$(this).hasClass("active")||$(this).addClass("active").siblings().removeClass("active"),0==e&&($("#dianzi-order-list").show(),$("#meitong-order-list").hide(),G.refresh()),1==e&&($("#meitong-order-list").show(),$("#dianzi-order-list").hide(),R.refresh(),V||(X(),V=!0))}),$("#order-detail .header-bar .back").on("tap",function(){$("#my-form").show().siblings().hide(),G.refresh(),R.refresh(),Q.refresh(),ee.refresh()}),$("#modify-btn").on("tap",function(){$("#modify-detail").show().siblings().hide(),function(){function e(e){var t=new Date,i=t.getFullYear(),n=t.getMonth()+1,o=t.getDate(),s=i+"-"+n+"-"+o,a="",r="",c="",l=JSON.stringify(detailData.name);if(1==e.formName&&(a+='<li class="item custom-name">\n        <div class="left name">姓名</div>\n        <input type="text" id="modify-custom-name" placeholder="请输入姓名" value='+l+">\n      </li>"),1==e.formIdCard&&(a+='<li class="item custom-id">\n        <div class="left id">身份证号码</div>\n        <input type="text" id="modify-custom-id" placeholder="请输入身份证号" value='+detailData.idCard+">\n      </li>"),1==e.formPhone&&(a+='<li class="item custom-phone">\n        <div class="left phone">手机号码</div>\n        <input type="text" id="modify-custom-phone" placeholder="请输入银行预留手机号" value='+detailData.phone+" maxlength=11 >\n      </li>"),1==e.formTicket){if(e.formTicketList&&e.formTicketList.length){if(r+='<div class="tittle">\n                      券码信息\n                   </div>',1==e.formExchangeType&&(r+='<div class="formExchangeType" id="formExchangeTypeModify">\n                        <div class="prefix">\n                          兑换类型\n                        </div>\n                        <ul class="exchangeTypeList">\n                          <li class="dianzi active">\n                            电子券\n                          </li>\n                          <li class="meitong">\n                            美通卡\n                          </li>\n                        </ul>\n                      </div>\n                      '),r+='<div class="list dianzi-list" id="dianzi-list-modify">\n                      <div class="list-item header">\n                        <div class="left">券码面值</div>\n                        <div class="right">数量</div>\n                      </div>',0==detailData.exchangeType)for(var d=0;d<e.formTicketList.length;d++){for(var m=e.formTicketList[d],f=!0,p=0;p<detailData.ticketList.length;p++){var h=detailData.ticketList[p];if(m.faceValue==h.faceValue){r+='<div class="list-item item">\n        <div class="left">'+m.faceValue+'</div>\n        <input type="text" class="right-modify" placeholder="输入兑换张数" ticket-code='+m.formTicketCode+" value="+(h?h.total:"")+">\n      </div>",f=!1;break}}f&&(r+='<div class="list-item item">\n        <div class="left">'+m.faceValue+'</div>\n        <input type="text" class="right-modify" placeholder="输入兑换张数" ticket-code='+m.formTicketCode+" value=''>\n      </div>")}if(1==detailData.exchangeType)for(var v=0;v<e.formTicketList.length;v++){var g=e.formTicketList[v];r+='<div class="list-item item">\n        <div class="left">'+g.faceValue+'</div>\n        <input type="text" class="right-modify" placeholder="输入兑换张数" ticket-code='+g.formTicketCode+">\n      </div>"}r+="</div>"}if(1==e.formExchangeType&&e.formMeitongTicketList&&e.formMeitongTicketList.length){r+='<div class="list meitong-list" id="meitong-list-modify">\n                        <div class="list-item header">\n                          <div class="left">券码面值</div>\n                          <div class="right">数量</div>\n                        </div>';var u=e.formMeitongTicketList.length;if(0==detailData.exchangeType)for(var y=0;y<u;y++){var k=e.formMeitongTicketList[y];e.meitongFaceMin==k.amount?r+='<div class="list-item item">\n        <div class="left">'+k.amount+'元</div>\n        <input type="text" class="right-modify" placeholder="输入兑换张数" ticket-code='+k.formTicketMeitongCode+' id="meitongMinModify">\n      </div>':r+='<div class="list-item item">\n        <div class="left">'+k.amount+'元</div>\n        <input type="text" class="right-modify" placeholder="输入兑换张数" ticket-code='+k.formTicketMeitongCode+">\n      </div>"}if(1==detailData.exchangeType)for(var x=0;x<u;x++){var w=e.formMeitongTicketList[x],T=!0;if(e.meitongFaceMin==w.amount){for(var L=0;L<detailData.meitongTicketList.length;L++){var b=detailData.meitongTicketList[L];if(w.amount==b.amount){r+='<div class="list-item item">\n        <div class="left">'+w.amount+'元</div>\n        <input type="text" class="right-modify" placeholder="输入兑换张数" ticket-code='+w.formTicketMeitongCode+" value="+(b?b.total:"")+' id="meitongMinModify">\n      </div>',T=!1;break}}T&&(r+='<div class="list-item item">\n        <div class="left">'+w.amount+'元</div>\n        <input type="text" class="right-modify" placeholder="输入兑换张数" ticket-code='+w.formTicketMeitongCode+" value='' id=\"meitongMinModify\">\n      </div>")}else{for(var C=0;C<detailData.meitongTicketList.length;C++){var j=detailData.meitongTicketList[C];if(w.amount==j.amount){r+='<div class="list-item item">\n        <div class="left">'+w.amount+'元</div>\n        <input type="text" class="right-modify" placeholder="输入兑换张数" ticket-code='+w.formTicketMeitongCode+" value="+(j?j.total:"")+">\n      </div>",T=!1;break}}T&&(r+='<div class="list-item item">\n        <div class="left">'+w.amount+'元</div>\n        <input type="text" class="right-modify" placeholder="输入兑换张数" ticket-code='+w.formTicketMeitongCode+" value=''>\n      </div>")}}r+='<div class="meitong-tips" id="meitong-tips-modify">\n                      <span class="iconfont icon-tishi1"></span>\n                      美通卡兑换最小面值'+e.meitongFaceMin+"元，"+e.meitongNumberMin+"张起兑\n                    </div>",r+="</div>"}}if(1==e.formDate&&(c+='<div class="tittle">\n      日期\n    </div>\n    \n    <input class="select-date" id="modify-date" type="text" readonly="" name="input_date" placeholder="请选择日期" data-lcalendar="'+s+',2030-12-31" value='+detailData.date+" />"),$("#modify-custom-info").html(a),$("#modify-custom-ticket").html(r),$("#modify-custom-date-box").html(c),1==(E=detailData.exchangeType)?($("#formExchangeTypeModify .exchangeTypeList .meitong").addClass("active").siblings().removeClass("active"),$("#meitong-list-modify").show(),$("#dianzi-list-modify").hide(),$("#formExchangeTypeModify .exchangeTypeList .dianzi").css({borderColor:"#ccc",color:"#ccc"})):$("#formExchangeTypeModify .exchangeTypeList .meitong").css({borderColor:"#ccc",color:"#ccc"}),1==e.formDate){var S=new lCalendar;S.init({trigger:"#modify-date",type:"date"})}}function n(){var e=sessionStorage.getItem("detailCode"),n=void 0;n={orderNo:detailData.orderNo,detailCode:e,exchangeType:E};var a=$("#modify-custom-name").val(),r=$("#modify-custom-id").val(),c=$("#modify-custom-phone").val();if($("#modify-custom-identify").val(),1==this.formName){if(!a)return void layer.open({content:"请输入姓名",skin:"msg",time:2});if(!(a.length<15))return void layer.open({content:"姓名长度过长",skin:"msg",time:2});n.name=a}if(1==this.formIdCard){if(!r)return void layer.open({content:"请输入身份证号",skin:"msg",time:2});if(!ce(r))return void layer.open({content:"身份证号格式输入有误",skin:"msg",time:2});n.idCard=r}if(1==this.formPhone){if(!c)return void layer.open({content:"请输入手机号码",skin:"msg",time:2});if(!re(c))return void layer.open({content:"手机号码格式输入有误！",skin:"msg",time:2});n.phone=c}if(1==this.formTicket){var l=[],d=[];if(0==E&&$("#dianzi-list-modify input[class=right-modify]").each(function(e,t){var i={},n=$(t).val();d.push(n),i.formTicketCode=$(t).attr("ticket-code"),i.total=n,l.push(i)}),1==E&&$("#meitong-list-modify input[class=right-modify]").each(function(e,t){var i={},n=$(t).val();d.push(n),i.formTicketMeitongCode=$(t).attr("ticket-code"),i.total=n,l.push(i)}),!d.some(function(e){return 1==!!e}))return void layer.open({content:"请至少填写一种券码数量！",skin:"msg",time:2});if(!d.every(function(e){return 0==isNaN(e)}))return void layer.open({content:"券码数量必须为数字！",skin:"msg",time:2});if(0==E&&(n.ticketList=l),1==E&&(n.meitongTicketList=l),1==E&&$("#meitongMinModify").val()){if(0==detailData.isReject&&$("#meitongMinModify").val()<o.meitongNumberMin)return void layer.open({content:"起兑量必须大于等于"+o.meitongNumberMin+"！",skin:"msg",time:2});if(1==detailData.isReject&&$("#meitongMinModify").val()<s.meitongNumberMin)return void layer.open({content:"起兑量必须大于等于"+s.meitongNumberMin+"！",skin:"msg",time:2})}}if(1==this.formDate){var m=$("#modify-date").val();if(!m)return void layer.open({content:"请选择日期！",skin:"msg",time:2});n.date=m}S||(S=!0,$.ajax({url:domain+"/order/update",type:"POST",dataType:"json",contentType:"application/json;charset=utf-8",cache:!0,data:JSON.stringify(n),headers:{token:t,userId:i},success:function(e){"SUCCESS"==e.code?(layer.open({content:"修改订单成功",skin:"msg",time:2}),$("#modify-detail input").val(""),$("#order-detail").show(),$("#modify-detail").hide(),K()):(ae(e.code),layer.open({content:e.msg,skin:"msg",time:2}))},error:function(e){console.log(e)},complete:function(e){S=!1}}))}0==detailData.isReject&&(e(o),$("#modify-submit").off("tap"),$("#modify-submit").on("tap",n.bind(o)),o.formExchangeType&&1==o.formExchangeType&&$("#meitongMinModify").on("change",function(){var e=Number($(this).val());isNaN(e)?($(this).val(""),layer.open({content:"请输入有效正整数！",skin:"msg",time:3})):e<o.meitongNumberMin&&($(this).val(""),layer.open({content:"此项起兑量必须大于等于"+o.meitongNumberMin+"！",skin:"msg",time:3}))})),1==detailData.isReject&&s&&(e(s),$("#modify-submit").off("tap"),$("#modify-submit").on("tap",n.bind(s)),s.formExchangeType&&1==s.formExchangeType&&$("#meitongMinModify").on("change",function(){var e=Number($(this).val());isNaN(e)?($(this).val(""),layer.open({content:"请输入有效正整数！",skin:"msg",time:3})):e<s.meitongNumberMin&&($(this).val(""),layer.open({content:"此项起兑量必须大于等于"+s.meitongNumberMin+"！",skin:"msg",time:3}))}))}()}),$("#delete-btn").on("tap",function(){$.dialog({type:"confirm",onClickOk:function(){var e=sessionStorage.getItem("detailCode"),n={detailCode:e};$.ajax({url:domain+"/order/reject/delete",type:"POST",dataType:"json",contentType:"application/json;charset=utf-8",data:JSON.stringify(n),headers:{token:t,userId:i},success:function(e){"SUCCESS"==e.code?(layer.open({content:"删除成功",skin:"msg",time:2}),"0"==detailData.isReject?($("#my-form").show(),$("#order-list").show(),$("#order-reject-list").hide(),$("#order-detail").hide(),G.refresh(),R.refresh(),Q.refresh(),ee.refresh()):($("#my-form").show(),$("#order-list").hide(),$("#order-reject-list").show(),$("#order-detail").hide(),G.refresh(),R.refresh(),Q.refresh(),ee.refresh()),G.refresh(),R.refresh(),Q.refresh(),ee.refresh()):layer.open({content:e.msg,skin:"msg",time:3})},error:function(e){console.log(e)},complete:function(e){}})},onClickCancel:function(){},contentHtml:'<p style="text-align: center">确认删除该用户数据吗？</p>'})}),$("#modify-detail .header-bar .back").on("tap",function(){$("#order-detail").show().siblings().hide()});var Q=new IScroll("#wrapper-reject",{scrollX:!0,probeType:2,mouseWheel:!0,scrollbars:!1});Q.on("scroll",function(){L=this.y,this.y>0&&(this.y>50?($("#pull-refresh-box-reject").css({height:"50"}),$("#pull-refresh-reject").html('<span class="iconfont icon-xiangshang"></span>释放立即刷新')):($("#pull-refresh-box-reject").css({height:this.y}),$("#pull-refresh-reject").html('<span class="iconfont icon-xiangxia"></span>继续下拉刷新')))}),Q.on("scrollEnd",function(){L>0&&($("#pull-refresh-box-reject").animate({height:0}),L>50&&($("#load-more-reject").text("正在努力加载数据...").show(),w=1,u=null,$("#search-reject").val(""),$("#wrapper-reject .list").html(""),$("#search-reject-btn").off("tap").css({borderColor:"#ccc",color:"#ccc"}),P||te())),this.wrapperHeight-this.y>=this.scrollerHeight&&(k?($("#load-more-reject").text("正在努力加载数据...").show(),$.ajax({url:domain+"/order/reject/query",type:"GET",cache:!0,dataType:"json",data:{query:u,page:w,exchangeType:0},headers:{token:t,userId:i},success:function(e){if("SUCCESS"==e.code){e.historyForm&&(s=e.historyForm),g=e.orderNo,k=!(!e.list||20!=e.list.length);var t="",i=e.list;if(i&&i.length)for(var n=0;n<i.length;n++){var o=i[n];if(t+="<li detail-code="+o.detailCode+' class="form-item clearBoth"><div class="index floatL">'+(n+20*(w-1)+1)+"</div>",o.name&&(t+='<div class="name floatL">'+o.name+"</div>"),o.idCard&&(t+='<div class="card-id floatL">'+o.idCard+"</div>"),o.phone&&(t+='<div class="phone floatL">'+o.phone+"</div>"),o.ticketList){t+='<div class="coupon floatL">';for(var a=0;a<o.ticketList.length;a++){var r=o.ticketList[a];t+="<p>"+r.faceValue+"/"+r.total+"张；</p>"}t+="</div>"}o.date&&(t+='<div class="date floatL">'+o.date+"</div>"),t+='<div class="modify-person floatL">'+(o.createBy?o.createBy:"--")+'</div><div class="last-modify-person floatL">'+(o.modifyBy?o.modifyBy:"--")+'</div><div class="time floatL">'+(o.modifyTime?o.modifyTime:"--")+"</div></li>"}$("#wrapper-reject .list").append(t),Y(),Q.refresh(),w++,k?$("#load-more-reject").hide():$("#load-more-reject").text("没有更多数据了").show(),$("#wrapper-reject .scroller .list .coupon").each(function(e,t){1==$(t).find("p").length&&$(t).css({lineHeight:"0.68rem"}),$(t).find("p").length>=3&&$(t).parent().css({lineHeight:.34*$(t).find("p").length+"rem"})})}else ae(e.code),layer.open({content:e.msg,skin:"msg",time:3})},error:function(e){console.log(e)}})):$("#load-more-reject").text("没有更多数据了").show())});var Z,ee=new IScroll("#wrapper-reject-meitong",{scrollX:!0,probeType:2,mouseWheel:!0,scrollbars:!1});function te(){P=!0,$.ajax({url:domain+"/order/reject/query",type:"GET",cache:!0,dataType:"json",data:{query:u,page:w,exchangeType:0},headers:{token:t,userId:i},success:function(e){if("SUCCESS"==e.code){e.historyForm&&(s=e.historyForm,ne(e.historyForm),1==e.historyForm.formExchangeType&&$("#exchangeTypeListRejectSearchBox").show()),g=e.orderNo,k=!(!e.list||20!=e.list.length);var t="",i=e.list;if(i&&i.length)for(var n=0;n<i.length;n++){var o=i[n];if(t+="<li detail-code="+o.detailCode+' class="form-item clearBoth"><div class="index floatL">'+(n+20*(w-1)+1)+"</div>",o.name&&(t+='<div class="name floatL">'+o.name+"</div>"),o.idCard&&(t+='<div class="card-id floatL">'+o.idCard+"</div>"),o.phone&&(t+='<div class="phone floatL">'+o.phone+"</div>"),o.ticketList){t+='<div class="coupon floatL">';for(var a=0;a<o.ticketList.length;a++){var r=o.ticketList[a];t+="<p>"+r.faceValue+"/"+r.total+"张；</p>"}t+="</div>"}o.date&&(t+='<div class="date floatL">'+o.date+"</div>"),t+='<div class="modify-person floatL">'+(o.createBy?o.createBy:"--")+'</div><div class="last-modify-person floatL">'+(o.modifyBy?o.modifyBy:"--")+'</div><div class="time floatL">'+(o.modifyTime?o.modifyTime:"--")+"</div></li>"}$("#wrapper-reject .list").append(t),Y(),Q.refresh(),w++,k?$("#load-more-reject").hide():$("#load-more-reject").text("没有更多数据了").show(),$("#wrapper-reject .scroller .list .coupon").each(function(e,t){1==$(t).find("p").length&&$(t).css({lineHeight:"0.68rem"}),$(t).find("p").length>=3&&$(t).parent().css({lineHeight:.34*$(t).find("p").length+"rem"})})}else ae(e.code),layer.open({content:e.msg,skin:"msg",time:3})},error:function(e){console.log(e)},complete:function(){P=!1}})}function ie(){U=!1,$.ajax({url:domain+"/order/reject/query",type:"GET",cache:!0,dataType:"json",data:{query:y,page:T,exchangeType:1},headers:{token:t,userId:i},success:function(e){if("SUCCESS"==e.code){e.historyForm&&(s=e.historyForm,ne(e.historyForm)),g=e.orderNo,x=!(!e.list||20!=e.list.length);var t="",i=e.list;if(i&&i.length)for(var n=0;n<i.length;n++){var o=i[n];if(t+="<li detail-code="+o.detailCode+' class="form-item clearBoth"><div class="index floatL">'+(n+20*(T-1)+1)+"</div>",o.name&&(t+='<div class="name floatL">'+o.name+"</div>"),o.idCard&&(t+='<div class="card-id floatL">'+o.idCard+"</div>"),o.phone&&(t+='<div class="phone floatL">'+o.phone+"</div>"),o.meitongTicketList){t+='<div class="coupon floatL">';for(var a=0;a<o.meitongTicketList.length;a++){var r=o.meitongTicketList[a];t+="<p>"+r.amount+"元/"+r.total+"张；</p>"}t+="</div>"}o.date&&(t+='<div class="date floatL">'+o.date+"</div>"),t+='<div class="modify-person floatL">'+(o.createBy?o.createBy:"--")+'</div><div class="last-modify-person floatL">'+(o.modifyBy?o.modifyBy:"--")+'</div><div class="time floatL">'+(o.modifyTime?o.modifyTime:"--")+"</div></li>"}$("#wrapper-reject-meitong .list").append(t),Y(),ee.refresh(),T++,x?$("#load-more-reject-meitong").hide():$("#load-more-reject-meitong").text("没有更多数据了").show(),$("#wrapper-reject-meitong .scroller .list .coupon").each(function(e,t){1==$(t).find("p").length&&$(t).css({lineHeight:"0.68rem"}),$(t).find("p").length>=3&&$(t).parent().css({lineHeight:.34*$(t).find("p").length+"rem"})})}else ae(e.code),layer.open({content:e.msg,skin:"msg",time:3})},error:function(e){console.log(e)},complete:function(){U=!1}})}function ne(e){var t=7.8,i='<li class="header clearBoth">\n        <div class="index floatL">序号</div>';1==e.formName&&(i+='<div class="name floatL">姓名</div>',t+=1.5),1==e.formIdCard&&(i+='<div class="card-id floatL">身份证号</div>',t+=3.2),1==e.formPhone&&(i+='<div class="phone floatL">手机号</div>',t+=2),1==e.formTicket&&(i+='<div class="coupon floatL">券码面值/数量</div>',t+=2),1==e.formDate&&(i+='<div class="date floatL">日期</div>',t+=2),i+='<div class="modify-person floatL">提交人</div>\n        <div class="last-modify-person floatL">最后修改人</div>\n        <div class="time floatL">最后修改时间</div></li>',0==I&&($("#wrapper-reject .list").html(i),$("#scroller-reject").css({width:t+"rem"})),1==I&&($("#wrapper-reject-meitong .list").html(i),$("#scroller-reject-meitong").css({width:t+"rem"}))}function oe(){u=$("#search-reject").val(),w=1,$("#wrapper-reject .list").html(""),P||te()}function se(){y=$("#search-reject-meitong").val(),T=1,$("#wrapper-reject-meitong .list").html(""),U||ie()}function ae(e){"TOKEN_INVALID"==e&&($("#login").show().siblings().hide(),window.location.reload())}function re(e){return!!/^[1][3,4,5,7,8][0-9]{9}$/.test(e)}function ce(e){return!1!==/(^\d{15}$)|(^\d{18}$)|(^\d{17}(\d|X|x)$)/.test(e)}ee.on("scroll",function(){b=this.y,this.y>0&&(this.y>50?($("#pull-refresh-box-reject-meitong").css({height:"50"}),$("#pull-refresh-reject-meitong").html('<span class="iconfont icon-xiangshang"></span>释放立即刷新')):($("#pull-refresh-box-reject-meitong").css({height:this.y}),$("#pull-refresh-reject-meitong").html('<span class="iconfont icon-xiangxia"></span>继续下拉刷新')))}),ee.on("scrollEnd",function(){b>0&&($("#pull-refresh-box-reject-meitong").animate({height:0}),b>50&&($("#load-more-reject-meitong").text("正在努力加载数据...").show(),T=1,y=null,$("#search-reject-meitong").val(""),$("#wrapper-reject-meitong .list").html(""),$("#search-reject-btn-meitong").off("tap").css({borderColor:"#ccc",color:"#ccc"}),U||ie())),this.wrapperHeight-this.y>=this.scrollerHeight&&(x?($("#load-more-reject-meitong").text("正在努力加载数据...").show(),$.ajax({url:domain+"/order/reject/query",type:"GET",cache:!0,dataType:"json",data:{query:y,page:T,exchangeType:1},headers:{token:t,userId:i},success:function(e){if("SUCCESS"==e.code){e.historyForm&&(s=e.historyForm),g=e.orderNo,x=!(!e.list||20!=e.list.length);var t="",i=e.list;if(i&&i.length)for(var n=0;n<i.length;n++){var o=i[n];if(t+="<li detail-code="+o.detailCode+' class="form-item clearBoth"><div class="index floatL">'+(n+20*(T-1)+1)+"</div>",o.name&&(t+='<div class="name floatL">'+o.name+"</div>"),o.idCard&&(t+='<div class="card-id floatL">'+o.idCard+"</div>"),o.phone&&(t+='<div class="phone floatL">'+o.phone+"</div>"),o.meitongTicketList){t+='<div class="coupon floatL">';for(var a=0;a<o.meitongTicketList.length;a++){var r=o.meitongTicketList[a];t+="<p>"+r.amount+"元/"+r.total+"张；</p>"}t+="</div>"}o.date&&(t+='<div class="date floatL">'+o.date+"</div>"),t+='<div class="modify-person floatL">'+(o.createBy?o.createBy:"--")+'</div><div class="last-modify-person floatL">'+(o.modifyBy?o.modifyBy:"--")+'</div><div class="time floatL">'+(o.modifyTime?o.modifyTime:"--")+"</div></li>"}$("#wrapper-reject .list").append(t),Y(),ee.refresh(),T++,x?$("#load-more-reject-meitong").hide():$("#load-more-reject-meitong").text("没有更多数据了").show(),$("#wrapper-reject-meitong .scroller .list .coupon").each(function(e,t){1==$(t).find("p").length&&$(t).css({lineHeight:"0.68rem"}),$(t).find("p").length>=3&&$(t).parent().css({lineHeight:.34*$(t).find("p").length+"rem"})})}else ae(e.code),layer.open({content:e.msg,skin:"msg",time:3})},error:function(e){console.log(e)}})):$("#load-more-reject-meitong").text("没有更多数据了").show())}),Z=!1,$(".reject").on("tap",function(){$("#order-list").hide(),$("#order-reject-list").show(),Z?(Q.refresh(),ee.refresh()):(Z=!0,te()),sessionStorage.setItem("reject","yes")}),$("#order-reject-list .header-bar .back").on("tap",function(){$("#order-reject-list").hide(),o&&"1"==o.submitFlag?$("#order-list").show():$("#have-submit").show(),G.refresh(),sessionStorage.setItem("reject","no")}),$("#submit-reject-form").on("tap",function(){C||$.dialog({type:"confirm",onClickOk:function(){C=!0,$.ajax({url:domain+"/order/reject/submit",type:"POST",dataType:"json",data:{orderNo:g},headers:{token:t,userId:i},success:function(e){"SUCCESS"==e.code?(sessionStorage.setItem("reject","no"),M=!1,$("#order-reject-list").hide(),o&&"1"==o.submitFlag?$("#order-list").show():$("#have-submit").show(),$(".reject").hide(),G.refresh(),layer.open({content:e.msg,skin:"msg",time:3})):(ae(e.code),layer.open({content:e.msg,skin:"msg",time:3}))},error:function(e){console.log(e)},complete:function(e){C=!1}})},onClickCancel:function(){},contentHtml:'<p style="text-align: center">确定要提交驳回表单？</p>'})}),function(){var e=!1;$("#exchangeTypeListRejectSearch li").on("tap",function(){var t=$(this).index();I=t,D=t,$(this).hasClass("active")||$(this).addClass("active").siblings().removeClass("active"),0==t&&($("#dianzi-list-reject").show(),$("#meitong-list-reject").hide(),Q.refresh()),1==t&&($("#meitong-list-reject").show(),$("#dianzi-list-reject").hide(),e?ee.refresh():(ie(),e=!0))})}(),$(".new-data-box").on("tap",function(){$("#add-new-data").show().siblings().hide(),D=0,function(){if(s){var e=s;!function(e){var t=new Date,i=(t.getFullYear(),t.getMonth(),t.getDate(),""),n="",o="";1==e.formName&&(i+='<li class = "item custom-name"><div class = "left name">姓名</div><input type="text" id="add-new-custom-name" placeholder="请输入姓名"></li>');1==e.formIdCard&&(i+='<li class="item custom-id">\n        \t\t\t<div class="left id">身份证号码</div>\n        \t\t\t<input type="text" id="add-new-custom-id" placeholder="请输入身份证号">\n     \t\t\t</li>');1==e.formPhone&&(i+='<li class="item custom-phone">\n        \t\t\t<div class="left phone">手机号码</div>\n        \t\t\t<input type="text" id="add-new-custom-phone" placeholder="请输入银行预留手机号">\n      \t\t\t</li>');if(1==e.formTicket){if(n+='<div class="tittle">\n                    券码信息\n                </div>',1==e.formExchangeType&&(n+='<div class="formExchangeType" id="add-new-form-exchange-type">\n                        <div class="prefix">\n                          \t兑换类型\n                        </div>\n                        <ul class="exchangeTypeList">\n                          \t<li class="dianzi active">\n                            \t电子券\n                          \t</li>\n                          \t<li class="meitong">\n                            \t美通卡\n                          \t</li>\n                        </ul>\n                      </div>'),e.formTicketList&&e.formTicketList.length){n+='<div class="list dianzi-list" id="add-new-dianzi-list">\n                        <div class="list-item header">\n                          \t<div class="left">券码面值</div>\n                          \t<div class="right">数量</div>\n                        </div>';for(var s=0;s<e.formTicketList.length;s++){var a=e.formTicketList[s];n+='<div class="list-item item">\n        \t\t\t\t\t<div class="left">'+a.faceValue+'</div>\n        \t\t\t\t\t<input type="text" class="right" placeholder="输入兑换张数" ticket-code='+a.formTicketCode+">\n      \t\t\t\t\t</div>"}n+="</div>"}if(1==e.formExchangeType&&e.formMeitongTicketList&&e.formMeitongTicketList.length){n+='<div class="list meitong-list" id="add-new-meitong-list">\n                        <div class="list-item header">\n                        <div class="left">券码面值</div>\n                        <div class="right">数量</div>\n                    </div>';for(var r=e.formMeitongTicketList.length,c=0;c<r;c++){var l=e.formMeitongTicketList[c];e.meitongFaceMin==l.amount?n+='<div class="list-item item">\n        \t\t\t\t\t\t<div class="left">'+l.amount+'元</div>\n        \t\t\t\t\t\t<input type="text" class="right" placeholder="输入兑换张数" ticket-code='+l.formTicketMeitongCode+' id="add-new-meitong-min">\n      \t\t\t\t\t\t</div>':n+='<div class="list-item item">\n        \t\t\t\t\t\t<div class="left">'+l.amount+'元</div>\n        \t\t\t\t\t\t<input type="text" class="right" placeholder="输入兑换张数" ticket-code='+l.formTicketMeitongCode+">\n      \t\t\t\t\t\t</div>"}n+='<div class="meitong-tips">\n                      \t<span class="iconfont icon-tishi1"></span>\n                      \t美通卡兑换最小面值'+e.meitongFaceMin+"元，"+e.meitongNumberMin+"张起兑\n                    </div>",n+="</div>"}}1==e.formDate&&(o+='<div class = "tittle">日期</div><input class="select-date" id="add-new-select-date" type="text" readonly="" name="input_date" placeholder="请选择日期" data-lcalendar="${dateNow},2030-12-31" />');if($("#add-new-custom-info").html(i),$("#add-new-custom-ticket").html(n),$("#add-new-custom-date").html(o),1==e.formDate){var d=new lCalendar;d.init({trigger:"#add-new-select-date",type:"date"})}}(e),e.formExchangeType&&1==e.formExchangeType&&($("#add-new-meitong-min").on("change",function(){var t=Number($(this).val());isNaN(t)?($(this).val(""),layer.open({content:"请输入有效正整数！",skin:"msg",time:3})):t<e.meitongNumberMin&&($(this).val(""),layer.open({content:"此项起兑量必须大于等于"+e.meitongNumberMin+"！",skin:"msg",time:3}))}),$("#add-new-form-exchange-type .exchangeTypeList li").on("tap",function(){if(!$(this).hasClass("active")){$(this).addClass("active").siblings().removeClass("active");var e=$(this).index();D=e,0==e?($("#add-new-dianzi-list").show(),$("#add-new-meitong-list").hide(),$("#add-new-meitong-list input").val("")):1==e&&($("#add-new-meitong-list").show(),$("#add-new-dianzi-list").hide(),$("#add-new-dianzi-list input").val(""))}}))}}()}),$("#add-new-data .header-bar .back").on("tap",function(){$("#my-form").show().siblings().hide(),G.refresh(),R.refresh(),Q.refresh(),ee.refresh()}),$("#add-new-data .header-bar .save").on("tap",function(){!function(){var e={};e.exchangeType=D,e.orderNo=g;var n=$("#add-new-custom-name").val(),a=$("#add-new-custom-id").val(),r=$("#add-new-custom-phone").val();if(1==s.formName){if(!n)return void layer.open({content:"请输入姓名",skin:"msg",time:2});if(!(n.length<15))return void layer.open({content:"姓名长度过长",skin:"msg",time:2});e.name=n}if(1==s.formIdCard){if(!a)return void layer.open({content:"请输入身份证号",skin:"msg",time:2});if(!ce(a))return void layer.open({content:"身份证号格式输入有误",skin:"msg",time:2});e.idCard=a}if(1==s.formPhone){if(!r)return void layer.open({content:"请输入手机号码",skin:"msg",time:2});if(!re(r))return void layer.open({content:"手机号码格式输入有误！",skin:"msg",time:2});e.phone=r}if(1==s.formTicket){var c=[],l=[];if(0==D&&$("#add-new-dianzi-list input[class=right]").each(function(e,t){var i={},n=$(t).val();l.push(n),i.formTicketCode=$(t).attr("ticket-code"),i.total=n,c.push(i)}),1==D&&$("#add-new-meitong-list input[class=right]").each(function(e,t){var i={},n=$(t).val();l.push(n),i.formTicketMeitongCode=$(t).attr("ticket-code"),i.total=n,c.push(i)}),!l.some(function(e){return 1==!!e}))return void layer.open({content:"请至少填写一种券码数量！",skin:"msg",time:2});if(!l.every(function(e){return 0==isNaN(e)}))return void layer.open({content:"券码数量必须为数字！",skin:"msg",time:2});if(0==D&&(e.ticketList=c),1==D&&(e.meitongTicketList=c),1==D&&$("#add-new-meitong-min").val()&&$("#add-new-meitong-min").val()<o.meitongNumberMin)return void layer.open({content:"起兑量必须大于"+o.meitongNumberMin+"！",skin:"msg",time:2})}if(1==s.formDate){var d=$("#add-new-select-date").val();if(!d)return void layer.open({content:"请选择日期！",skin:"msg",time:2});e.date=d}z||(z=!0,$.ajax({url:domain+"/order/reject/save",type:"POST",dataType:"json",contentType:"application/json;charset=utf-8",cache:!0,data:JSON.stringify(e),headers:{token:t,userId:i},success:function(e){"SUCCESS"==e.code?(layer.open({content:"保存成功",skin:"msg",time:2}),$("#add-new-data .custom input").val(""),$("#add-new-data .ticket input").val(""),$("#add-new-data .date input").val(""),$("#my-form").show(),$("#add-new-data").hide(),G.refresh(),R.refresh(),Q.refresh(),ee.refresh()):(ae(e.code),layer.open({content:e.msg,skin:"msg",time:3}))},error:function(e){console.log(e)},complete:function(e){z=!1}}))}()}),$("#search-reject").on("input",function(){0==this.value.length?$("#search-reject-btn").off("tap",oe).css({borderColor:"#ccc",color:"#ccc"}):$("#search-reject-btn").css({borderColor:"#3ca9c8",color:"#3ca9c8"}).off("tap",oe).on("tap",oe)}),$("#search-reject-meitong").on("input",function(){0==this.value.length?$("#search-reject-btn-meitong").off("tap").css({borderColor:"#ccc",color:"#ccc"}):$("#search-reject-btn-meitong").css({borderColor:"#3ca9c8",color:"#3ca9c8"}).off("tap").on("tap",se)})})}]);